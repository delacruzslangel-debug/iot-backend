<script>
const API = ""; // mismo dominio (Render)

/* =========================
   Cargar estado inicial
========================= */
async function cargarEstado() {
  try {
    const res = await fetch(API + "/state");
    if (!res.ok) throw new Error("Backend no responde");

    const data = await res.json();
    actualizar(data.state);
  } catch (e) {
    mostrarError();
  }
}

/* =========================
   Toggle LED
========================= */
async function toggle() {
  try {
    const res = await fetch(API + "/toggle");
    if (!res.ok) throw new Error("Error toggle");

    const data = await res.json();
    actualizar(data.state);
  } catch (e) {
    mostrarError();
  }
}

/* =========================
   Actualizar UI
========================= */
function actualizar(state) {
  const btn = document.getElementById("btn");
  const estado = document.getElementById("estado");

  estado.innerText = "Estado: " + state;

  if (state === "ON") {
    btn.innerText = "APAGAR";
    btn.className = "off";
  } else {
    btn.innerText = "ENCENDER";
    btn.className = "on";
  }
}

/* =========================
   Error backend
========================= */
function mostrarError() {
  const btn = document.getElementById("btn");
  const estado = document.getElementById("estado");

  btn.innerText = "Error backend";
  btn.className = "";
  estado.innerText = "Estado: --";
}

/* =========================
   Inicio
========================= */
window.onload = cargarEstado;
</script>
